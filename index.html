<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ç©åˆ†é‘½çŸ³è¨ˆç®—å™¨</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      margin: 40px auto;
      max-width: 800px;
      background-color: #f9f9f9;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      color: #333;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: space-between;
    }
    .input-group, .output-group {
      flex: 1 1 360px;
      padding: 20px;
      border-radius: 8px;
      background-color: #fff;
      box-shadow: 0 0 5px rgba(0,0,0,0.05);
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input {
      width: 100%;
      padding: 8px;
      font-size: 16px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 16px;
      background-color: #4285f4;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background-color: #3367d6;
    }
    #result {
      font-size: 16px;
      line-height: 1.6;
    }
    b {
      color: #d9534f;
    }
  </style>
</head>
<body>
  <h2>ğŸ® æ´»å‹•ç©åˆ† / é‘½çŸ³èŠ±è²»è¨ˆç®—å™¨</h2>
  <div class="container">
    <div class="input-group">
      <label>ç›®å‰åˆ†æ•¸</label>
      <input type="number" id="currentScore" placeholder="ä¾‹å¦‚ï¼š45000">

      <label>ç›®æ¨™åˆ†æ•¸</label>
      <input type="number" id="targetScore" placeholder="ä¾‹å¦‚ï¼š200000">

      <label>åŠ æˆ % æ•¸ï¼ˆä¾‹å¦‚è¼¸å…¥ 20 è¡¨ç¤º +20%ï¼‰</label>
      <input type="number" id="bonus" placeholder="ä¾‹å¦‚ï¼š20">

      <label>ç›®å‰é‘½çŸ³æ•¸é‡</label>
      <input type="number" id="diamondsOwned" placeholder="ä¾‹å¦‚ï¼š120">

      <label>æ´»å‹•é–‹å§‹æ™‚é–“</label>
      <input type="datetime-local" id="startDate">

      <label>æ´»å‹•çµæŸæ™‚é–“</label>
      <input type="datetime-local" id="endDate">

      <label>é«”åŠ›é“å…·å¯è£œç¸½é«”åŠ›æ•¸</label>
      <input type="number" id="staminaFromItems" placeholder="ä¾‹å¦‚ï¼š30">

      <button onclick="calculate()">é–‹å§‹è¨ˆç®—</button>
    </div>

    <div class="output-group">
      <h3>è¨ˆç®—çµæœï¼š</h3>
      <div id="result">ğŸ‘‰ è«‹å¡«å¯«ä¸Šæ–¹æ¬„ä½ä¸¦æŒ‰ä¸‹æŒ‰éˆ•ã€‚</div>
    </div>
  </div>

  <script>
    // é è¨­æ´»å‹•é–‹å§‹æ™‚é–“ç‚ºä»Šå¤©
    window.onload = function () {
      const now = new Date();
      const localISOTime = now.toISOString().slice(0, 16);
      document.getElementById("startDate").value = localISOTime;
    };

    function calculate() {
      let n = 1 + parseFloat(document.getElementById("bonus").value) / 100;
      let t = parseFloat(document.getElementById("targetScore").value);
      let s = parseFloat(document.getElementById("currentScore").value);
      let k = parseInt(document.getElementById("diamondsOwned").value);
      let p = parseInt(document.getElementById("staminaFromItems").value);
      let start = new Date(document.getElementById("startDate").value);
      let end = new Date(document.getElementById("endDate").value);

      if (isNaN(n) || isNaN(t) || isNaN(s) || isNaN(k) || isNaN(p) || isNaN(start) || isNaN(end)) {
        document.getElementById("result").innerHTML = "âš ï¸ è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼";
        return;
      }

      if (start >= end) {
        document.getElementById("result").innerHTML = "âš ï¸ æ´»å‹•çµæŸæ™‚é–“å¿…é ˆæ™šæ–¼é–‹å§‹æ™‚é–“ï¼";
        return;
      }

      let diffMs = end - start;
      let totalHours = Math.floor(diffMs / (1000 * 60 * 60));
      let d = Math.floor(totalHours / 24); // æ´»å‹•ç¸½å¤©æ•¸
      let m = totalHours % 24;             // å¤šå‡ºä¾†çš„æ™‚æ•¸

      let x = Math.ceil((t - s) / (2890 * n));       // æ‰€éœ€é«”åŠ›
      let freeStamina = 2 * m + 10 * d + p;          // å…è²»å–å¾—é«”åŠ›
      let y = Math.max(x - freeStamina, 0);          // é«”åŠ›ç¼ºå£
      let a = 2 * y + 10 * d;                        // é ä¼°é‘½çŸ³æ¶ˆè€—
      let b = Math.max(a - k, 0);                    // é‚„éœ€è³¼è²·é‘½çŸ³æ•¸

      document.getElementById("result").innerHTML =
        ` æ´»å‹•æœŸé–“ï¼š<b>${d}</b> å¤© <b>${m}</b> å°æ™‚<br>
          éœ€è¦é«”åŠ›ç¸½å…±ï¼š<b>${x}</b><br>
          é«”åŠ›ç¼ºå£ï¼š<b>${y}</b><br>
          é ä¼°éœ€èŠ±é‘½çŸ³ï¼š<b>${a}</b><br>
          é‚„éœ€é¡å¤–è³¼è²·é‘½çŸ³ï¼š<b>${b}</b>`;
    }
  </script>
</body>
</html>